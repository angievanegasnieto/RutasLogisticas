IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'logisticsdb')
BEGIN
    CREATE DATABASE logisticsdb;
END
USE logisticsdb;

CREATE TABLE roles (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  nombre VARCHAR(50) NOT NULL UNIQUE,         -- ADMIN, COORDINADOR , OPERADOR, CONDUCTOR
  descripcion VARCHAR(200)
) ENGINE=InnoDB;

CREATE TABLE usuarios (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  usuario VARCHAR(50) NOT NULL UNIQUE,
  contrasena_hash VARCHAR(255) NOT NULL,
  nombre_completo VARCHAR(120) NOT NULL,
  correo VARCHAR(120) UNIQUE,
  activo TINYINT(1) NOT NULL DEFAULT 1,
  creado_en TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE usuario_rol (
  usuario_id BIGINT NOT NULL,
  rol_id BIGINT NOT NULL,
  PRIMARY KEY (usuario_id, rol_id),
  CONSTRAINT fk_ur_usuario FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
  CONSTRAINT fk_ur_rol FOREIGN KEY (rol_id) REFERENCES roles(id)
) ENGINE=InnoDB;

CREATE TABLE vehiculos (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  placa VARCHAR(20) NOT NULL UNIQUE,
  modelo VARCHAR(80),
  capacidad_volumen DECIMAL(10,2) NOT NULL DEFAULT 0,  -- m3
  capacidad_peso DECIMAL(10,2) NOT NULL DEFAULT 0,     -- kg
  estado ENUM('ACTIVO','INACTIVO','MANTENIMIENTO') NOT NULL DEFAULT 'ACTIVO',
  notas VARCHAR(255)
) ENGINE=InnoDB;

CREATE TABLE conductores (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  nombre_completo VARCHAR(120) NOT NULL,
  licencia VARCHAR(50) NOT NULL UNIQUE,
  telefono VARCHAR(30),
  estado ENUM('ACTIVO','INACTIVO') NOT NULL DEFAULT 'ACTIVO'
) ENGINE=InnoDB;
